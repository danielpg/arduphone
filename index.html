<html>
<head>
<style>
.mybutton{padding:5px;text-align:center;color:white;background:#00A5FF;border-radius:5px;width:120px;margin-bottom:5px;cursor:pointer}
</style>
<script src="js/jquery-2.1.3.min.js"></script>
<script type="text/javascript"  src="cordova.js"></script> 
<script>
var bluelist = [];
var desktop = 0;

//if(desktop == 0){
if(window.location.href.indexOf("localhost") >= 0 ){
	$(function(){ onDeviceReady(); });
} else {
	document.addEventListener("deviceready", onDeviceReady, false);
}
	
function onDeviceReady() {
	refreshlist();
	$("#ok").html("javascript OK");
}

function refreshlist(){
	bluetoothSerial.list(function(data){
		bluelist = data;
		say_list(data);
		drawlist();
	}, function(){});	
}

function drawlist(){
	for(i = 0; i < bluelist.length; i++ ){
			$("#list").append("<div class='mybutton' onclick='select_blue(" + i + ")'>" + bluelist[i].name + "</div>");	

	}
}

function select_blue(id){
	bluetoothSerial.connect(bluelist[id].address, function(){ 
		alert("connected");		
	}, function(){ alert("notConnected"); });
}

function button1(){
	bluetoothSerial.write("a", function(){
		alert("WriteOK");
	}, function(){ 
		alert("writeError");
	});
}

function button2(){
	bluetoothSerial.write("b", function(){
		alert("WriteOK");
	}, function(){ 
		alert("writeError");
	});
}

function activeRead(){
	bluetoothSerial.subscribe('\n', function (data) {
	    
		//console.log(data);
	    
	}, function(){   }
		//error Reading
	);
}

//bluetoothSerial.write(data, success, failure);
//

function say_list(items){
	for(i = 0; i < items.length; i++ ){
		$("#console").append("<div>object:</div>");
		for (var mkey in items[i]){
			$("#console").append("<div><b>" + mkey + "</b>: " + items[i][mkey] + "</div>");	
		
		}
	}
}


function myclose(){
	if (navigator.app) {
	    navigator.app.exitApp();
	} else if (navigator.device) {
	    navigator.device.exitApp();
	} else {
	    window.close();
	}
}

</script>

</head>
<body>
Grua
<div id="list"></div>
<div id="buttons">
<div class="mybutton" onclick="button1();" style="background:#f48341">Button A</div>
<div class="mybutton" onclick="button2();"  style="background:#f4427d">Button B</div>
</div>
<div id="console"></div>
<div id="ok"></div>
</body>
</html>
